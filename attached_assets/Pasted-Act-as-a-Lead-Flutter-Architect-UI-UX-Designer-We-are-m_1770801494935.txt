Act as a Lead Flutter Architect & UI/UX Designer.
We are moving from the "Prototype Phase" to the "Production Phase" for the app 'Neighbor Storage (이웃창고)'.

Your goal is to refactor and expand the current codebase to include ALL necessary screens, logic, and data structures required for a commercial launch. The app must be robust, handle errors gracefully, and follow the Clean Architecture principle.

---

## 1. Project Scope & Design System (Strict)
- **App Name:** 이웃창고 (Neighbor Storage)
- **Target Audience:** Residents of Uiwang-si (Hyper-local).
- **Design Language:**
  - **Primary:** `#FFD700` (Mustard Yellow) - Use for CTA buttons, active tabs, highlights.
  - **Secondary:** `#333333` (Dark Gray) - Main text.
  - **Surface:** `#F5F5F5` (Backgrounds) / `#FFFFFF` (Cards).
  - **Radius:** 16.0 for all Cards and Modal bottom sheets.
  - **Font:** Google Fonts `Noto Sans KR`.
  - **Animation:** Use `flutter_animate` for subtle entry effects on lists.

## 2. Tech Stack Requirements
- **State Management:** `flutter_riverpod` (Use AsyncNotifier for loading/error states).
- **Navigation:** `go_router` (Implement `ShellRoute` for the 5-Tab persistent BottomBar).
- **Backend:** `supabase_flutter` (Assume the DB schema provided below is active).
- **Maps:** `flutter_map` (OpenStreetMap) or a Placeholder Image with a generic map pin if API key is missing.
- **Utils:** `intl` (Currency), `image_picker` (Upload), `flutter_rating_bar` (Reviews).

---

## 3. Full Feature List & Logic (Must Implement All)

### A. Authentication & Onboarding
1. **Splash Screen:** Logo animation -> Check Auth State -> Redirect.
2. **Login Screen:** Social Login Buttons (Kakao/Google style UI) + "Browse without Login" text button.
3. **Location Auth Screen:** "Verify Neighborhood" logic (Mock GPS check).

### B. Tab 1: Home (The Market)
1. **Header:** Location Dropdown ("오전동") + Search Bar + Notification Bell.
2. **Section 1: Pro Partners (B2C):** Horizontal Scroll. Queries `users` where `is_shop_owner = true`.
3. **Section 2: Categories:** Filter Chips (Camping, Tools, Digital, Kids, etc.).
4. **Section 3: Recent Items (C2C):** Vertical Infinite Scroll.
5. **Map Feature:** FAB (Floating Action Button) toggles between "List View" and "Map View".

### C. Tab 2: Chat (Real-time)
1. **Chat List:** Shows last message, timestamp, unread count badge.
2. **Chat Room:** - **Header:** Shows the Item info (Mini Card) + "Rental Status" button.
   - **Status Logic:** The Owner can change status: [Request] -> [Accepted] -> [Rented] -> [Returned].
   - **System Messages:** "Deposit confirmed", "Rental started".

### D. Tab 3: Upload (The Hub)
- **UI:** Full-screen Modal or Page.
- **Fields:** Photos (Multiple), Title, Category, Price/Day, Deposit.
- **Toggles:**
  - `Teach Option`: "Can you teach how to use it?"
  - `Delivery Option`: "Can you deliver via neighbor courier?"

### E. Tab 4: My Storage (Dashboard)
1. **Wallet Card:** Shows "Current Balance" and "Held Deposits (Escrow)".
2. **Tabs:** [My Items] (Manage my listings) vs [Rental History] (Items I borrowed).
3. **Action:** "Withdraw Funds" button.

### F. Tab 5: Settings
1. **Profile:** Edit Nickname/Avatar.
2. **Pro Partner:** "Apply for Pro Partner" form link.
3. **Support:** FAQ, Terms of Service.

### G. Item Detail & Checkout (The Core)
1. **Detail Screen:**
   - Image Carousel (Hero animation).
   - "Pro Badge" & "Teach Badge" logic.
   - **Vendor Profile:** Clickable to see other items.
   - **Calendar:** Date Range Picker for rental period.
   - **Reviews:** Section showing star ratings.
2. **Checkout Screen:**
   - **Date Summary:** Start Date ~ End Date (Total Days).
   - **Delivery Method:** Radio Button [Pickup (0krw) vs Express (+3000krw)].
   - **Price Breakdown:** (Price x Days) + Delivery + **Deposit**.
   - **Escrow Logic:** Display "Deposit is held securely until return".

---

## 4. Database Schema (Assume this exists in Supabase)

```sql
-- Users
create table profiles (
  id uuid primary key references auth.users,
  nickname text,
  is_shop_owner boolean default false,
  trust_score float default 36.5,
  avatar_url text
);

-- Items
create table items (
  id bigint generated by default as identity primary key,
  owner_id uuid references profiles(id),
  title text,
  category text,
  price_per_day int,
  deposit int,
  description text,
  is_pro_item boolean default false,
  can_teach boolean default false,
  can_deliver boolean default false,
  images text[],
  created_at timestamptz default now()
);

-- Rentals (Transactions)
create table rentals (
  id bigint generated by default as identity primary key,
  item_id bigint references items(id),
  borrower_id uuid references profiles(id),
  status text check (status in ('REQUESTED', 'PAID', 'ACTIVE', 'COMPLETED', 'DISPUTED')),
  total_price int,
  deposit_held int,
  is_delivery_requested boolean
);